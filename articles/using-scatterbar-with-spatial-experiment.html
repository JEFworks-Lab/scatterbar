<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using scatterbar with a SpatialExperiment object • scatterbar</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using scatterbar with a SpatialExperiment object">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scatterbar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/customizing_scatterbar.html">Customizing scatterbar</a></li>
    <li><a class="dropdown-item" href="../articles/flipping-scatterbar-oreintations.html">Flipping scatterbar oreintations and positions</a></li>
    <li><a class="dropdown-item" href="../articles/getting-started-with-scatterbars.html">Getting started with scatterbars</a></li>
    <li><a class="dropdown-item" href="../articles/using-scatterbar-with-spatial-experiment.html">Using scatterbar with a SpatialExperiment object</a></li>
    <li><a class="dropdown-item" href="../articles/using-scatterbar-with-visium.html">Using scatterbar with Visium data</a></li>
    <li><a class="dropdown-item" href="../articles/visualizing-multiple-datasets.html">Visualizing multiple datasets with scatterbar</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JEFworks-Lab/scatterbar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using scatterbar with a SpatialExperiment object</h1>
                        <h4 data-toc-skip class="author">Dee Velazquez
and Jean Fan</h4>
            
            <h4 data-toc-skip class="date">2024-11-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JEFworks-Lab/scatterbar/blob/main/vignettes/using-scatterbar-with-spatial-experiment.Rmd" class="external-link"><code>vignettes/using-scatterbar-with-spatial-experiment.Rmd</code></a></small>
      <div class="d-none name"><code>using-scatterbar-with-spatial-experiment.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="using-scatterbar-with-a-spatialexperiment-object">Using <code>scatterbar</code> with a <code>SpatialExperiment</code>
object<a class="anchor" aria-label="anchor" href="#using-scatterbar-with-a-spatialexperiment-object"></a>
</h2>
<p>This tutorial demonstrates how to visualize cell-type proportions
with <code>scatterbar</code> from a <code>SpatialExperiment</code>
object. <code>SpatialExperiment</code> is a class from Bioconductor that
stores information from spatial-omics experiments, which we can use to
visualize the cell types found in certain spots. We will use
<code>SEraster</code> to rasterize cell-type counts and calculate their
proportions within pixels, when can then be utilized by
<code>scatterbar</code>.</p>
<p>For more information on <code>SpatialExperiment</code>, click [here]
(<a href="https://www.bioconductor.org/packages/release/bioc/vignettes/SpatialExperiment/inst/doc/SpatialExperiment.html" class="external-link uri">https://www.bioconductor.org/packages/release/bioc/vignettes/SpatialExperiment/inst/doc/SpatialExperiment.html</a>).</p>
<div class="section level3">
<h3 id="load-libraries">Load libraries<a class="anchor" aria-label="anchor" href="#load-libraries"></a>
</h3>
<p>First, we need to loading the necessary libraries and load in the
dataset provided by <code>SEraster</code>. It is a preprocessed MERFISH
dataset of the mouse preoptic area (POA) from a female naive animal. For
more information, please refer to the original work, <a href="https://www.science.org/doi/10.1126/science.aau5324" class="external-link">Moffitt J.
and Bambah-Mukku D. et al. (2018), “Molecular, spatial, and functional
single-cell profiling of the hypothalamic preoptic region”, <em>Science
Advances</em></a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/drighelli/SpatialExperiment" class="external-link">SpatialExperiment</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: SingleCellExperiment</span></span>
<span><span class="co">#&gt; Loading required package: SummarizedExperiment</span></span>
<span><span class="co">#&gt; Loading required package: MatrixGenerics</span></span>
<span><span class="co">#&gt; Loading required package: matrixStats</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'MatrixGenerics'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:matrixStats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,</span></span>
<span><span class="co">#&gt;     colCounts, colCummaxs, colCummins, colCumprods, colCumsums,</span></span>
<span><span class="co">#&gt;     colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,</span></span>
<span><span class="co">#&gt;     colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,</span></span>
<span><span class="co">#&gt;     colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,</span></span>
<span><span class="co">#&gt;     colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,</span></span>
<span><span class="co">#&gt;     colWeightedMeans, colWeightedMedians, colWeightedSds,</span></span>
<span><span class="co">#&gt;     colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,</span></span>
<span><span class="co">#&gt;     rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,</span></span>
<span><span class="co">#&gt;     rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,</span></span>
<span><span class="co">#&gt;     rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,</span></span>
<span><span class="co">#&gt;     rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,</span></span>
<span><span class="co">#&gt;     rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,</span></span>
<span><span class="co">#&gt;     rowWeightedMads, rowWeightedMeans, rowWeightedMedians,</span></span>
<span><span class="co">#&gt;     rowWeightedSds, rowWeightedVars</span></span>
<span><span class="co">#&gt; Loading required package: GenomicRanges</span></span>
<span><span class="co">#&gt; Loading required package: stats4</span></span>
<span><span class="co">#&gt; Loading required package: BiocGenerics</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'BiocGenerics'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     IQR, mad, sd, var, xtabs</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     anyDuplicated, aperm, append, as.data.frame, basename, cbind,</span></span>
<span><span class="co">#&gt;     colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,</span></span>
<span><span class="co">#&gt;     get, grep, grepl, intersect, is.unsorted, lapply, Map, mapply,</span></span>
<span><span class="co">#&gt;     match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,</span></span>
<span><span class="co">#&gt;     Position, rank, rbind, Reduce, rownames, sapply, saveRDS, setdiff,</span></span>
<span><span class="co">#&gt;     table, tapply, union, unique, unsplit, which.max, which.min</span></span>
<span><span class="co">#&gt; Loading required package: S4Vectors</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'S4Vectors'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     findMatches</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     expand.grid, I, unname</span></span>
<span><span class="co">#&gt; Loading required package: IRanges</span></span>
<span><span class="co">#&gt; Loading required package: GenomeInfoDb</span></span>
<span><span class="co">#&gt; Loading required package: Biobase</span></span>
<span><span class="co">#&gt; Welcome to Bioconductor</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Vignettes contain introductory material; view with</span></span>
<span><span class="co">#&gt;     'browseVignettes()'. To cite Bioconductor, see</span></span>
<span><span class="co">#&gt;     'citation("Biobase")', and for packages 'citation("pkgname")'.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'Biobase'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:MatrixGenerics':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     rowMedians</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:matrixStats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     anyMissing, rowMedians</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'S4Arrays::makeNindexFromArrayViewport' by</span></span>
<span><span class="co">#&gt; 'DelayedArray::makeNindexFromArrayViewport' when loading 'SummarizedExperiment'</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JEFworks-Lab/SEraster" class="external-link">SEraster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JEFworks-Lab/scatterbar" class="external-link">scatterbar</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the MERFISH dataset from mouse POA (Preoptic Area)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"merfish_mousePOA"</span><span class="op">)</span></span></code></pre></div>
<p>We can see that this data is in the form of a
<code>SpatialExperiment</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check the class of the dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">merfish_mousePOA</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "SpatialExperiment"</span></span>
<span><span class="co">#&gt; attr(,"package")</span></span>
<span><span class="co">#&gt; [1] "SpatialExperiment"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="rasterize-cell-type-counts">Rasterize Cell-Type Counts<a class="anchor" aria-label="anchor" href="#rasterize-cell-type-counts"></a>
</h3>
<p>To aggregate cell-type data into spatial pixels, we use the
<code>rasterizeCellType</code> function from <code>SEraster</code>. This
function takes the <code>SpatialExperiment</code> object and generates a
rasterized view of cell-type counts. We will rasterize at a resolution
of 55 micrometers (µm) and use the “sum” function to aggregate the
number of cells.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rasterize the cell-type data at 55um resolution</span></span>
<span><span class="va">rastCt</span> <span class="op">&lt;-</span> <span class="fu">SEraster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SEraster/man/rasterizeCellType.html" class="external-link">rasterizeCellType</a></span><span class="op">(</span></span>
<span>  <span class="va">merfish_mousePOA</span>,  <span class="co"># SpatialExperiment object</span></span>
<span>  col_name <span class="op">=</span> <span class="st">"celltype"</span>,  <span class="co"># Column with cell-type information</span></span>
<span>  resolution <span class="op">=</span> <span class="fl">55</span>,  <span class="co"># Set resolution to 55 micrometers</span></span>
<span>  fun <span class="op">=</span> <span class="st">"sum"</span>,  <span class="co"># Sum up the cells within each pixel</span></span>
<span>  square <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># Use square-shaped pixels for rasterization</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize the rasterized result (total number of cells per pixel)</span></span>
<span><span class="fu">SEraster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SEraster/man/plotRaster.html" class="external-link">plotRaster</a></span><span class="op">(</span><span class="va">rastCt</span>, name <span class="op">=</span> <span class="st">"Total cells"</span><span class="op">)</span></span></code></pre></div>
<p><img src="using-scatterbar-with-spatial-experiment_files/figure-html/rasterize-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="calculate-cell-type-proportions">Calculate Cell-Type Proportions<a class="anchor" aria-label="anchor" href="#calculate-cell-type-proportions"></a>
</h3>
<p>Next, we calculate the proportions of each cell type within each
pixel. We first retrieve the list of cell IDs for each pixel and the
corresponding cell types. We then calculate the proportions for each
cell type by dividing the number of cells of a given type by the total
number of cells in each pixel.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract the list of cell IDs for each pixel</span></span>
<span><span class="va">cellids_perpixel</span> <span class="op">&lt;-</span> <span class="fu">colData</span><span class="op">(</span><span class="va">rastCt</span><span class="op">)</span><span class="op">$</span><span class="va">cellID_list</span></span>
<span></span>
<span><span class="co"># Retrieve the cell-type information</span></span>
<span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="va">merfish_mousePOA</span><span class="op">$</span><span class="va">celltype</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ct</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">merfish_mousePOA</span><span class="op">)</span></span>
<span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">ct</span><span class="op">)</span>  <span class="co"># Ensure cell types are factors</span></span>
<span></span>
<span><span class="co"># Calculate proportions for each pixel</span></span>
<span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">cellids_perpixel</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ct</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set rownames to match the pixel IDs in the raster object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">prop</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">rastCt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">prop</span><span class="op">)</span>  <span class="co"># Display the first few rows of the proportions matrix</span></span>
<span><span class="co">#&gt;         Ambiguous Astrocyte Endothelial 1 Endothelial 2 Endothelial 3 Ependymal</span></span>
<span><span class="co">#&gt; pixel21 0.2000000 0.0000000     0.0000000             0             0         0</span></span>
<span><span class="co">#&gt; pixel22 0.0000000 0.0000000     0.5000000             0             0         0</span></span>
<span><span class="co">#&gt; pixel23 0.0000000 0.3333333     0.0000000             0             0         0</span></span>
<span><span class="co">#&gt; pixel24 0.0000000 0.0000000     0.3333333             0             0         0</span></span>
<span><span class="co">#&gt; pixel25 0.6666667 0.0000000     0.0000000             0             0         0</span></span>
<span><span class="co">#&gt; pixel26 0.0000000 0.3333333     0.0000000             0             0         0</span></span>
<span><span class="co">#&gt;         Excitatory Inhibitory Microglia OD Immature 1 OD Immature 2 OD Mature 1</span></span>
<span><span class="co">#&gt; pixel21  0.2000000  0.6000000         0     0.0000000             0           0</span></span>
<span><span class="co">#&gt; pixel22  0.0000000  0.5000000         0     0.0000000             0           0</span></span>
<span><span class="co">#&gt; pixel23  0.0000000  0.3333333         0     0.3333333             0           0</span></span>
<span><span class="co">#&gt; pixel24  0.6666667  0.0000000         0     0.0000000             0           0</span></span>
<span><span class="co">#&gt; pixel25  0.3333333  0.0000000         0     0.0000000             0           0</span></span>
<span><span class="co">#&gt; pixel26  0.6666667  0.0000000         0     0.0000000             0           0</span></span>
<span><span class="co">#&gt;         OD Mature 2 OD Mature 3 OD Mature 4 Pericytes</span></span>
<span><span class="co">#&gt; pixel21           0           0           0         0</span></span>
<span><span class="co">#&gt; pixel22           0           0           0         0</span></span>
<span><span class="co">#&gt; pixel23           0           0           0         0</span></span>
<span><span class="co">#&gt; pixel24           0           0           0         0</span></span>
<span><span class="co">#&gt; pixel25           0           0           0         0</span></span>
<span><span class="co">#&gt; pixel26           0           0           0         0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrieve-pixel-coordinates">Retrieve Pixel Coordinates<a class="anchor" aria-label="anchor" href="#retrieve-pixel-coordinates"></a>
</h3>
<p>For <code>scatterbar</code>, we also need the x and y coordinates of
the pixels from the <code>rastCt</code> object. These spatial
coordinates correspond to the positions of each pixel in the rasterized
grid.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract the spatial coordinates of the pixels (x, y)</span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html" class="external-link">spatialCoords</a></span><span class="op">(</span><span class="va">rastCt</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span>  <span class="co"># Display the first few rows of the spatial coordinates</span></span>
<span><span class="co">#&gt;              x    y</span></span>
<span><span class="co">#&gt; pixel21 1099.5 -0.5</span></span>
<span><span class="co">#&gt; pixel22 1154.5 -0.5</span></span>
<span><span class="co">#&gt; pixel23 1209.5 -0.5</span></span>
<span><span class="co">#&gt; pixel24 1264.5 -0.5</span></span>
<span><span class="co">#&gt; pixel25 1319.5 -0.5</span></span>
<span><span class="co">#&gt; pixel26 1374.5 -0.5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filter-pixels-with-more-than-one-cell">Filter Pixels with More than One Cell<a class="anchor" aria-label="anchor" href="#filter-pixels-with-more-than-one-cell"></a>
</h3>
<p>We only want to visualize pixels that contain more than one cell, so
we filter out pixels that do not meet this criterion.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter for pixels that only contain more than one cell for visualization</span></span>
<span><span class="va">vi</span> <span class="op">&lt;-</span> <span class="fu">colData</span><span class="op">(</span><span class="va">rastCt</span><span class="op">)</span><span class="op">$</span><span class="va">num_cell</span> <span class="op">&gt;</span> <span class="fl">1</span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="va">pos</span><span class="op">[</span><span class="va">vi</span>, <span class="op">]</span>  <span class="co"># Filter spatial coordinates</span></span>
<span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="va">prop</span><span class="op">[</span><span class="va">vi</span>, <span class="op">]</span>  <span class="co"># Filter proportions matrix</span></span>
<span></span>
<span><span class="co"># Check dimensions to ensure filtering was successful</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1035    2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">prop</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1035   16</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualize-cell-type-proportions-using-scatterbar">Visualize Cell-Type Proportions Using <code>scatterbar</code><a class="anchor" aria-label="anchor" href="#visualize-cell-type-proportions-using-scatterbar"></a>
</h3>
<p>Now that we have both the cell-type proportions and pixel position
coordinates, we can visualize the data using <code>scatterbar</code>. We
pass the proportions and coordinates, along with custom colors, to
create a <code>scatterbar</code> plot. Remember that both the
proportions and position data must be data frames in order to be passed
into scatterbar.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate custom colors for the cell types</span></span>
<span><span class="va">custom_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">ct</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize the cell-type proportions using scatterbar</span></span>
<span><span class="va">start.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">scatterbar</span><span class="fu">::</span><span class="fu"><a href="../reference/scatterbar.html">scatterbar</a></span><span class="op">(</span></span>
<span>  <span class="va">prop</span>,  <span class="co"># Proportions matrix</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span>,  <span class="co"># Spatial coordinates</span></span>
<span>  colors <span class="op">=</span> <span class="va">custom_colors</span>,  <span class="co"># Custom colors for each cell type</span></span>
<span>  padding_x <span class="op">=</span> <span class="fl">10</span>,  <span class="co"># Add padding to the x-axis</span></span>
<span>  padding_y <span class="op">=</span> <span class="fl">10</span>, <span class="co"># Add padding to the y-axis</span></span>
<span>  legend_title <span class="op">=</span> <span class="st">"Cell Types"</span> <span class="co"># Legend title</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Maintain aspect ratio</span></span>
<span><span class="co">#&gt; Calculated size_x: 44.7069487500984</span></span>
<span><span class="co">#&gt; Calculated size_y: 44.7069487500984</span></span>
<span><span class="co">#&gt; Applied padding_x: 10</span></span>
<span><span class="co">#&gt; Applied padding_y: 10</span></span></code></pre></div>
<p><img src="using-scatterbar-with-spatial-experiment_files/figure-html/scatterbar-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">end.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">end.time</span> <span class="op">-</span> <span class="va">start.time</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time difference of 0.3328471 secs</span></span></code></pre></div>
<p>This plot shows the proportion of each cell type within each pixel,
with bars stacked to represent the composition of cell types. The colors
correspond to different cell types, as defined by the custom color
vector.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dee Velazquez, Jean Fan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
